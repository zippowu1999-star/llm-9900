# Kaggle时间序列销售预测 - AI代理系统

基于OpenAI API的智能销售预测系统，专门用于Kaggle Store Sales Time Series Forecasting竞赛。该系统整合了多源数据（销售、油价、节假日、交易等），使用AI代理进行智能预测。

## 🎯 项目特色

- **🚀 高性能**: 预计算优化，O(1)查询速度
- **🧠 智能预测**: 整合油价、节假日、促销等多维因素
- **📊 多源数据**: 充分利用所有可用数据源
- **⚡ 快速部署**: 简化架构，专注Kaggle提交

## 📁 项目结构

```
9900p/
├── simple_kaggle.py          # 🎯 主要预测脚本
├── simple_agent.py           # 🤖 简化AI代理
├── data_loader.py            # 📊 数据加载和预处理
├── config.py                 # ⚙️ 配置文件
├── requirements.txt          # 📦 依赖包
├── env_example.txt           # 🔑 环境变量示例
├── README.md                 # 📖 项目说明
└── datasets/                 # 📂 数据目录
    └── store-sales-time-series-forecasting/
        ├── train.csv         # 训练数据 (3M+ 记录)
        ├── test.csv          # 测试数据 (28K+ 记录)
        ├── stores.csv        # 商店信息
        ├── oil.csv           # 油价数据
        ├── holidays_events.csv # 节假日数据
        └── transactions.csv  # 交易数据
```

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 设置OpenAI API密钥

```bash
export OPENAI_API_KEY=your_openai_api_key_here
```

### 3. 运行预测

```bash
python simple_kaggle.py
```

## 📊 数据整合

系统充分利用所有数据源：

### 🏪 商店数据 (stores.csv)
- 商店编号、类型、城市、州
- 影响区域销售模式

### 🛒 销售数据 (train.csv)
- 历史销售记录 (2013-2017)
- 按商店、产品类别、日期分组

### 🛍️ 交易数据 (transactions.csv)
- 每日交易量
- 反映商店活跃度

### 🛢️ 油价数据 (oil.csv)
- 每日油价波动
- 影响消费者购买力

### 🎉 节假日数据 (holidays_events.csv)
- 全国和地方节假日
- 影响销售季节性模式

## 🤖 AI代理特性

### 智能上下文分析
```python
预测样本:
- 商店编号: 1
- 产品类别: AUTOMOTIVE
- 日期: 2017-08-16
- 促销状态: False

日期上下文信息:
- 油价: $52.50
- 是否节假日: 否
- 节假日类型: 无
- 最近7天平均油价: $52.45

该商店该产品类别历史数据:
- 平均销售额: $3.20
- 最近7天平均销售额: $2.80
- 历史销售额范围: $0.00 - $15.00
- 零销售天数占比: 45.2%
```

### 性能优化
- **预计算统计**: 提前计算所有商店-产品组合的统计指标
- **O(1)查询**: 避免重复DataFrame筛选
- **缓存机制**: 减少重复计算

## 📈 预测结果示例

```
🏆 Kaggle预测 - 简化版
========================================
🎉 预测完成!
⏱️  耗时: 4.61 秒
🚀 速度: 1.09 预测/秒
📁 文件: test_submission.csv
📊 样本数: 5
💰 平均销售额: $379.66
========================================
```

## 🎯 Kaggle提交格式

生成标准Kaggle提交文件：

```csv
id,sales
3000888,3.8
3000889,0.0
3000890,4.5
3000891,1890.0
3000892,0.0
```

## ⚙️ 配置选项

### 模型选择 (config.py)
```python
OPENAI_MODEL = "gpt-4o"  # 可选: gpt-3.5-turbo, gpt-4
```

### 预测参数
- **样本数量**: 可配置测试样本数
- **重试机制**: 指数退避重试
- **并发控制**: 避免API限流

## 🔧 技术架构

### 数据流
```
原始CSV → DataLoader → 特征工程 → SimpleAgent → OpenAI API → 预测结果
```

### 核心组件
1. **DataLoader**: 数据加载、清洗、特征工程
2. **SimpleAgent**: AI代理，上下文分析，预测生成
3. **Config**: 统一配置管理

### 性能优化策略
- **预计算**: 避免重复计算历史统计
- **缓存**: 智能缓存机制
- **批量处理**: 优化API调用

## 📊 预测质量

系统考虑多种因素进行预测：

1. **历史模式**: 基于真实销售历史
2. **季节性**: 节假日和促销效应
3. **外部因素**: 油价波动影响
4. **商店特性**: 不同商店的销售模式
5. **产品类别**: 不同产品的销售特性

## 🚀 扩展功能

### 完整预测
修改 `simple_kaggle.py` 中的样本数量：
```python
# 预测所有测试样本
test_samples = test_data.head(None)  # 或指定数量
```

### 模型切换
在 `config.py` 中切换模型：
```python
OPENAI_MODEL = "gpt-3.5-turbo"  # 更快的模型
OPENAI_MODEL = "gpt-4o"         # 更强的模型
```

## 🐛 故障排除

### API限流
```
HTTP/1.1 429 Too Many Requests
```
**解决方案**: 
- 切换到gpt-3.5-turbo
- 减少并发请求
- 增加重试间隔

### 预测不合理
**解决方案**: 
- 检查历史数据上下文
- 验证油价和节假日数据
- 调整prompt模板

## 📝 日志输出

系统提供详细的日志信息：
```
2025-10-05 10:04:39,544 - simple_agent - INFO - ✅ 销售统计摘要计算完成，共 1,782 个商店-产品组合
2025-10-05 10:04:40,580 - simple_agent - INFO -    ✅ 预测完成: ID 3000888, 销售额 $3.80
```

## 🤝 贡献

欢迎提交问题报告和改进建议！

## 📄 许可证

MIT License

---

**🎯 专为Kaggle竞赛优化的高性能AI预测系统**